---
import { fetchAPI } from "../lib/api.js";
import { siteDefaults } from "../lib/constants.js";

let phoneNumber = siteDefaults.phoneNumber;
let primaryEmail = siteDefaults.primaryEmail;
let secondaryEmail = siteDefaults.secondaryEmail;
let address = siteDefaults.address;

const data = await fetchAPI("site-setting");
if (data?.data?.attributes) {
  const attrs = data.data.attributes;
  phoneNumber = attrs.phoneNumber || phoneNumber;
  primaryEmail = attrs.primaryEmail || primaryEmail;
  secondaryEmail = attrs.secondaryEmail || secondaryEmail;
  address = attrs.address || address;
}

const phoneHref = phoneNumber ? `tel:+64${phoneNumber.replace(/\s/g, "")}` : "";
---

<section
  id="contact"
  class="bg-gray-100 py-16 px-4"
  data-aos="fade-in"
  data-aos-duration="750"
  data-aos-delay="250"
  data-aos-once="true"
>
  <div
    class="max-w-7xl sm:mx-auto bg-white rounded-xl shadow-lg p-8 space-y-12"
  >
    <div
      class="flex flex-col lg:flex-row justify-between items-center space-y-8 lg:space-y-0 lg:space-x-8"
    >
      <div class="w-full lg:w-1/4">
        <h2 class="text-4xl font-bold mb-4">Contact Us</h2>
        <p class="text-lg mb-4">
          Mobile: <a href={phoneHref} class="text-blue-600">{phoneNumber}</a>
          <br />
          <a href={`mailto:${primaryEmail}`} class="text-blue-600"
            >{primaryEmail}</a
          ><br />
          <a href={`mailto:${secondaryEmail}`} class="text-blue-600"
            >{secondaryEmail}</a
          >
        </p>
      </div>
      <div class="w-full lg:w-3/4">
        <iframe
          class="w-full h-80 rounded-lg"
          src="https://maps.google.com/maps?width=520&height=400&hl=en&q=%20Mapua+(Tasman)&t=&z=8&ie=UTF8&iwloc=B&output=embed"
          allowfullscreen
        >
        </iframe>
      </div>
    </div>
    <form id="contactForm" class="space-y-6">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <input
          type="text"
          placeholder="Your Name *"
          class="input input-bordered w-full"
          name="Name"
          required
        />
        <input
          type="email"
          placeholder="Your Email *"
          class="input input-bordered w-full"
          name="FromEmail"
          required
        />
      </div>
      <div>
        <label for="File" class="text-sm text-gray-400"
          >Attach File (e.g Site Plan)</label
        >
        <input
          type="file"
          class="mt-1 file-input file-input-bordered w-full"
          name="File"
        />
      </div>
      <input
        type="text"
        placeholder="Subject *"
        class="input input-bordered w-full"
        name="Subject"
        required
      />
      <textarea
        placeholder="Your Message *"
        class="textarea textarea-bordered w-full"
        rows="5"
        name="Message"
        required></textarea>
      <div class="text-center">
        <button
          type="submit"
          class="btn btn-primary text-white px-12 w-full sm:w-auto"
          ><span
            id="loadingSpinner"
            class="loading loading-spinner loading-md hidden"></span>Send
          Message</button
        >
        <p id="successMessage" class="pt-4 text-success hidden">
          Email sent successfully, we will be in touch soon.
        </p>
        <p id="errorMessage" class="pt-4 text-error hidden">
          An error occurred, please check the form provided.
        </p>
      </div>
    </form>
  </div>

  <script define:vars={{ apiUrl: import.meta.env.PUBLIC_API_URL || "http://localhost:1337" }}>
    window.apiUrl = apiUrl;
  </script>

  <script is:inline src="/js/contact.js"></script>
</section>
